<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device=width, initial-scale=1">
    <title>작품 추천 목록 | 북북노벨</title>

    <!-- bootstrap v5.3 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/css/bootstrap.min.css"
        integrity="sha512-fw7f+TcMjTb7bpbLJZlP8g2Y4XcCyFZW8uy8HsRZsH/SwbMw0plKHFHr99DN3l04VsYNwvzicUX/6qurvIxbxw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- bootstrap icons 1.13.1 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <!-- jquery toast plugin v1.3.2 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css"
        integrity="sha512-wJgJNTBBkLit7ymC6vvzM1EcSWeM9mmOu+1USHaRBbHkm6W9EgM0HY27+UtUaprntaYQJF75rc8gjxllKs5OIQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* 사용자 정의 스타일 */
        .search-highlight {
            background-color: yellow;
            font-weight: bold;
        }
        
        .no-results {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 18px;
        }
        
        .page-info {
            color: #666;
            font-size: 14px;
        }
        
        .table tbody tr {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .pagination .page-link {
            color: #6c757d;
            border: 1px solid #dee2e6;
        }
        
        .pagination .page-item.active .page-link {
            background-color: #343a40;
            border-color: #343a40;
            color: white;
        }
        
        .pagination .page-link:hover {
            background-color: #e9ecef;
        }
        
        .table-container {
            min-height: 500px;
        }
        
        .post-row {
            display: table-row;
        }
        
        .post-row.hidden {
            display: none !important;
        }
    </style>
</head>

<body>
     <!-- navbar -->
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-success sticky-top flex-column">
        <div class="container-fluid container-xl">
            <div class="">
                <a class="navbar-brand fs-2"><i class="bi bi-book me-2"></i>북북노벨</a>
                <div class="navbar-nav">
                    <a class="nav-link text-white" href="../home/home.html">자유</a>
                    <a class="nav-link text-white" href="../home/ranking.html">랭킹</a>
                    <a class="nav-link text-white" href="../user_board/free_list.html">유저 게시판</a>
                </div>
            </div>
            <form class="d-flex" role="search">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" />
                <button class="btn btn-outline-light" type="submit">Search</button>
            </form>
        </div>
    </nav>
    <!-- navbar -->

    <!--본문-->
    <div class="container-sm">
        <div class="container-sm mt-3 py-4 border-bottom border-dark border-3">
            <span class="fs-1 fw-bold">작품 추천</span>
        </div>
        
        <!-- 검색 -->
        <div class="container text-end mt-2">
            <div class="d-flex justify-content-end">
                <div class="d-flex me-3">
                    <div class="me-1 p-2">
                        <label for="category">카테고리:&nbsp;</label>
                    </div>
                    <div>
                        <select class="form-control" id="category" name="category">
                            <option value="title">제목</option>
                            <option value="author">작성자명</option>
                            <option value="comment">댓글</option>
                        </select>
                    </div>
                </div>
                <div class="d-flex">
                    <div class="me-1 p-2">
                        <label for="search-term">&nbsp;검색어:&nbsp;</label>
                    </div>
                    <div class="me-1">
                        <input class="form-control" type="text" id="search-term" name="q" placeholder="검색어를 입력하세요">
                    </div>
                    <div class="me-1">
                        <button class="btn btn-success" type="button" id="search-btn">검색</button>
                    </div>
                    <div class="me-1">
                        <button class="btn btn-outline-secondary" type="button" id="reset-btn">초기화</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 검색 결과 정보 -->
        <div class="container mt-2">
            <div class="d-flex justify-content-between align-items-center">
                <div class="page-info" id="result-info">
                    전체 <span id="total-count">0</span>개의 게시물이 있습니다.
                </div>
                <div class="page-info">
                    <span id="current-page-info">1</span> / <span id="total-page-info">1</span> 페이지
                </div>
            </div>
        </div>
        
        <!-- 게시판 -->
        <div class="container-sm table-container">
            <table class="table table-hover mt-3">
                <thead>
                    <tr class="border-top text-center table-light">
                        <th class="border-start border-end col-8">제목</th>
                        <th class="border-start border-end col-2">작성자</th>
                        <th class="border-start border-end col-1">등록일</th>
                        <th class="border-start border-end col-1">추천수</th>
                    </tr>
                </thead>
                <tbody class="align-middle fs-5 fw-bold" id="importantList">
                    <!-- 베스트 게시물들이 동적으로 생성됩니다 -->
                </tbody>
                <tbody class="align-middle fs-5" id="noticeList">
                    <!-- 일반 게시물들이 동적으로 생성됩니다 -->
                </tbody>
            </table>
            
            <!-- 검색 결과 없음 메시지 -->
            <div id="no-results" class="no-results" style="display: none;">
                <i class="bi bi-search" style="font-size: 48px; color: #ccc;"></i>
                <p>검색 결과가 없습니다.</p>
                <p>다른 검색어로 시도해보세요.</p>
            </div>
        </div>
        <!-- 게시판끝 -->
        
        <!--글쓰기버튼-->
        <div class="mt-3 text-end">
            <button type="button" class="btn btn-outline-dark" id="addButton" onclick="location.href='useredit.html'">
                <i class="bi bi-pencil-fill me-1"></i>글쓰기
            </button>
        </div>

        <!-- 페이지네이션 -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center" id="pagination">
                <!-- 페이지 버튼들이 동적으로 생성됩니다 -->
            </ul>
        </nav>
    </div>
    <!--본문끝-->

    <!-- bootstrap v5.3 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/js/bootstrap.bundle.min.js"
        integrity="sha512-Tc0i+vRogmX4NN7tuLbQfBxa8JkfUSAxSFVzmU31nVdHyiHElPPy2cWfFacmCJKw0VqovrzKhdd2TSTMdAxp2g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- jquery v3.7.1 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- jquery toast plugin v1.3.2 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"
        integrity="sha512-zlWWyZq71UMApAjih4WkaRpikgY9Bz1oXIW5G0fED4vk14JjGlQ1UmkGM392jEULP8jbNMiwLWdM8Z87Hu88Fw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- custom -->
    <script>
        $(document).ready(function() {
            // 게시물 데이터 (실제로는 서버에서 가져올 데이터)
            let allPosts = [
                {
                    id: 1,
                    title: "쟤내 회사 망했데 ㅋㅋ",
                    author: "zㅣ존멸망",
                    date: "25.07.04",
                    likes: 10,
                    isBest: true,
                    link: "../user_board/review.html"
                },
                {
                    id: 2,
                    title: "사실 뻥임",
                    author: "뻥장수",
                    date: "25.07.04",
                    likes: 2,
                    isBest: false,
                    link: "../user_board/review.html"
                },
                {
                    id: 3,
                    title: "국가권력을 뛰어넘는 헌터",
                    author: "날씨조아",
                    date: "25.07.05",
                    likes: 5,
                    isBest: false,
                    link: "../user_board/review.html"
                },
                {
                    id: 4,
                    title: "죽어야만 살아남는 인간의 이야기",
                    author: "배고파요",
                    date: "25.07.05",
                    likes: 3,
                    isBest: false,
                    link: "../user_board/review.html"
                },
                {
                    id: 5,
                    title: "오직 나만이 이 세계의 끝을 알고 있다",
                    author: "개발자123",
                    date: "25.07.06",
                    likes: 8,
                    isBest: false,
                    link: "../user_board/review.html"
                },
                {
                    id: 6,
                    title: "게임속으로 들어간 고인물의 탑 정복기",
                    author: "주말러버",
                    date: "25.07.06",
                    likes: 4,
                    isBest: false,
                    link: "../user_board/review.html"
                },
                {
                    id: 7,
                    title: "회귀물 추천합니다",
                    author: "카페인중독",
                    date: "25.07.07",
                    likes: 6,
                    isBest: false,
                    link: "../user_board/review.html"
                },
                {
                    id: 8,
                    title: "이 작품 정말 재밌다",
                    author: "영화매니아",
                    date: "25.07.07",
                    likes: 12,
                    isBest: true,
                    link: "../user_board/review.html"
                },
                {
                    id: 9,
                    title: "웹소설 추천 합니다",
                    author: "독서왕",
                    date: "25.07.08",
                    likes: 7,
                    isBest: false,
                    link: "../user_board/review.html"
                },
                {
                    id: 10,
                    title: "이 작품 이대로 괜찮다",
                    author: "헬스초보",
                    date: "25.07.08",
                    likes: 9,
                    isBest: false,
                    link: "../user_board/review.html"
                },
                {
                    id: 11,
                    title: "일본 웹소설 추천",
                    author: "여행러",
                    date: "25.07.09",
                    likes: 11,
                    isBest: false,
                    link: "../user_board/review.html"
                },
                {
                    id: 12,
                    title: "러브코미디 웹소설 재밌는거 찾았다",
                    author: "취미탐험가",
                    date: "25.07.09",
                    likes: 3,
                    isBest: false,
                    link: "../user_board/review.html"
                }
            ];
            
            let filteredPosts = [...allPosts]; // 필터링된 게시물 배열
            let currentPage = 1; // 현재 페이지
            let itemsPerPage = 10; // 페이지당 아이템 수
            
            // 테이블 행 HTML 생성 함수
            function createRowHTML(post) {
                const bestBadge = post.isBest ? 
                    '<span class="border border-0 bg-primary-subtle rounded px-3 py-2 text-primary me-1">베스트</span>' : 
                    '';
                
                return `
                    <tr class="post-row" data-id="${post.id}" data-title="${post.title.toLowerCase()}" data-author="${post.author.toLowerCase()}">
                        <td class="px-4 py-4 post-title">
                            ${bestBadge}<span class="title-text">${post.title}</span>
                        </td>
                        <td class="text-center post-author">${post.author}</td>
                        <td class="text-center">${post.date}</td>
                        <td class="text-center">${post.likes}</td>
                    </tr>
                `;
            }
            
            // 모든 게시물 렌더링
            function renderAllPosts() {
                const importantList = $('#importantList');
                const noticeList = $('#noticeList');
                
                importantList.empty();
                noticeList.empty();
                
                filteredPosts.forEach(post => {
                    const rowHTML = createRowHTML(post);
                    if (post.isBest) {
                        importantList.append(rowHTML);
                    } else {
                        noticeList.append(rowHTML);
                    }
                });
                
                // 행 클릭 이벤트 추가
                $('.post-row').click(function() {
                    const postId = $(this).data('id');
                    const post = allPosts.find(p => p.id === postId);
                    if (post && post.link) {
                        location.href = post.link;
                    }
                });
                
                updateResultInfo();
                renderPagination();
                showPage(1);
            }
            
            // 페이지네이션 렌더링
            function renderPagination() {
                const totalPages = Math.ceil(filteredPosts.length / itemsPerPage);
                const pagination = $('#pagination');
                pagination.empty();
                
                if (totalPages <= 1) {
                    pagination.hide();
                    return;
                }
                
                pagination.show();
                
                // 처음 페이지 버튼
                pagination.append(`
                    <li class="page-item ${currentPage <= 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" id="first-page" aria-label="First">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                `);
                
                // 이전 페이지 버튼
                pagination.append(`
                    <li class="page-item ${currentPage <= 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" id="prev-page" aria-label="Previous">
                            <span aria-hidden="true">&lt;</span>
                        </a>
                    </li>
                `);
                
                // 페이지 번호 버튼들
                const startPage = Math.max(1, currentPage - 2);
                const endPage = Math.min(totalPages, currentPage + 2);
                
                for (let i = startPage; i <= endPage; i++) {
                    const activeClass = i === currentPage ? 'active' : '';
                    pagination.append(`
                        <li class="page-item ${activeClass}">
                            <a class="page-link page-num" href="#" data-page="${i}">${i}</a>
                        </li>
                    `);
                }
                
                // 다음 페이지 버튼
                pagination.append(`
                    <li class="page-item ${currentPage >= totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" id="next-page" aria-label="Next">
                            <span aria-hidden="true">&gt;</span>
                        </a>
                    </li>
                `);
                
                // 마지막 페이지 버튼
                pagination.append(`
                    <li class="page-item ${currentPage >= totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" id="last-page" aria-label="Last">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                `);
                
                // 페이지 정보 업데이트
                $('#current-page-info').text(currentPage);
                $('#total-page-info').text(totalPages);
            }
            
            // 특정 페이지 표시
            function showPage(page) {
                const totalPages = Math.ceil(filteredPosts.length / itemsPerPage);
                currentPage = Math.max(1, Math.min(page, totalPages));
                
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                
                // 모든 행 숨기기
                $('.post-row').addClass('hidden');
                
                // 현재 페이지의 게시물들만 표시
                const currentPosts = filteredPosts.slice(startIndex, endIndex);
                currentPosts.forEach(post => {
                    $(`.post-row[data-id="${post.id}"]`).removeClass('hidden');
                });
                
                // 결과 없음 메시지 처리
                if (filteredPosts.length === 0) {
                    $('#no-results').show();
                    $('.table').hide();
                } else {
                    $('#no-results').hide();
                    $('.table').show();
                }
                
                renderPagination();
                
                // 스크롤을 테이블 맨 위로
                $('html, body').animate({
                    scrollTop: $('.table').offset().top - 100
                }, 300);
            }
            
            // 검색 결과 정보 업데이트
            function updateResultInfo() {
                const searchTerm = $('#search-term').val().trim();
                
                if (searchTerm) {
                    $('#result-info').html(`'<strong>${searchTerm}</strong>' 검색 결과: <span id="total-count">${filteredPosts.length}</span>개`);
                } else {
                    $('#result-info').html(`전체 <span id="total-count">${filteredPosts.length}</span>개의 게시물이 있습니다.`);
                }
            }
            
            // 검색 기능
            function performSearch() {
                const searchTerm = $('#search-term').val().trim().toLowerCase();
                const category = $('#category').val();
                
                if (!searchTerm) {
                    filteredPosts = [...allPosts];
                } else {
                    filteredPosts = allPosts.filter(post => {
                        if (category === 'title') {
                            return post.title.toLowerCase().includes(searchTerm);
                        } else if (category === 'author') {
                            return post.author.toLowerCase().includes(searchTerm);
                        } else if (category === 'comment') {
                            // 댓글 검색은 실제로는 서버에서 처리해야 하지만, 
                            // 여기서는 제목과 작성자에서 검색하도록 함
                            return post.title.toLowerCase().includes(searchTerm) || 
                                   post.author.toLowerCase().includes(searchTerm);
                        }
                        return false;
                    });
                }
                
                // 검색 결과 하이라이트
                if (searchTerm) {
                    setTimeout(() => {
                        highlightSearchTerm(searchTerm);
                    }, 100);
                }
                
                renderAllPosts();
                
                // 토스트 메시지
                $.toast({
                    heading: '검색 완료',
                    text: `${filteredPosts.length}개의 결과를 찾았습니다.`,
                    icon: 'info',
                    position: 'top-right',
                    hideAfter: 2000
                });
            }
            
            // 검색어 하이라이트
            function highlightSearchTerm(term) {
                if (!term) return;
                
                $('.title-text, .post-author').each(function() {
                    const $this = $(this);
                    const text = $this.text();
                    const regex = new RegExp(`(${term})`, 'gi');
                    const highlightedText = text.replace(regex, '<span class="search-highlight">$1</span>');
                    $this.html(highlightedText);
                });
            }
            
            // 하이라이트 제거
            function removeHighlight() {
                $('.search-highlight').each(function() {
                    const $this = $(this);
                    $this.replaceWith($this.text());
                });
            }
            
            // 검색 초기화
            function resetSearch() {
                $('#search-term').val('');
                $('#category').val('title');
                filteredPosts = [...allPosts];
                removeHighlight();
                renderAllPosts();
                
                $.toast({
                    heading: '검색 초기화',
                    text: '모든 게시물을 표시합니다.',
                    icon: 'success',
                    position: 'top-right',
                    hideAfter: 2000
                });
            }
            
            // 이벤트 핸들러들
            $('#search-btn').click(function(e) {
                e.preventDefault();
                performSearch();
            });
            
            $('#reset-btn').click(function(e) {
                e.preventDefault();
                resetSearch();
            });
            
            // Enter 키로 검색
            $('#search-term').keypress(function(e) {
                if (e.which === 13) {
                    e.preventDefault();
                    performSearch();
                }
            });
            
            // 페이지네이션 이벤트 (이벤트 위임 사용)
            $(document).on('click', '#first-page', function(e) {
                e.preventDefault();
                if (!$(this).parent().hasClass('disabled')) {
                    showPage(1);
                }
            });
            
            $(document).on('click', '#last-page', function(e) {
                e.preventDefault();
                if (!$(this).parent().hasClass('disabled')) {
                    const totalPages = Math.ceil(filteredPosts.length / itemsPerPage);
                    showPage(totalPages);
                }
            });
            
            $(document).on('click', '#prev-page', function(e) {
                e.preventDefault();
                if (!$(this).parent().hasClass('disabled')) {
                    showPage(currentPage - 1);
                }
            });
            
            $(document).on('click', '#next-page', function(e) {
                e.preventDefault();
                if (!$(this).parent().hasClass('disabled')) {
                    showPage(currentPage + 1);
                }
            });
            
            $(document).on('click', '.page-num', function(e) {
                e.preventDefault();
                const page = parseInt($(this).data('page'));
                showPage(page);
            });
            
            // 초기 렌더링
            renderAllPosts();
        });
    </script>
</body>

</html>